{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saved</title>
    <link rel="stylesheet" href="{% static 'styles/styles.css' %}?v=1.0">
    <link rel="stylesheet" href="{% static 'styles/saved.css' %}?v=1.0">
</head>
<body>
<div id="sidebar">
    <div id="sidebar_content" class="hidden">
        <p><a href="{% url 'core:profilepage' %}">Profile</a></p>
        <p><a href="{% url 'core:home' %}">Home</a></p>
        <p><a href="{% url 'core:organization' %}">Organization</a></p>
        <p><a href="{% url 'core:saved' %}">Saved</a></p>
        <p><a href="{% url 'core:email' %}">Email</a></p>
    </div>
    <hr class="divider_sidebar"/>
    
    <div class="notification_container">
        <!-- Notification Pop-Up -->
            <div id="notification_popup" class="hidden">
            <h2>Notifications</h2><button id="close_notification_popup" class="close-btn">&times;</button>
            <div id="notification_list">
                <ul>
                    <li class="notification_item" data-detail="General meeting at 10:30 AM on January 3, 2024, will be held in the main conference room. All employees are expected to attend this important session where key company updates and strategic initiatives for the upcoming year will be discussed.">
                        <p>Schedule Update <span>Yesterday</span></p>
                        <p class="short-description">General meeting at 10:30AM on Jan 3, 202 General meeting at 10:30AM on Jan 3, 202</p>
                        <p class="posted-by">- Imee Duterte</p>
                    </li>
                    <li class="notification_item" data-detail="Another meeting detail here.">
                        <p>Schedule Update <span>Yesterday</span></p>
                        <p class="short-description">Another meeting detail here General meeting at 10:30AM on Jan 3, 202 General meet</p>
                        <p class="posted-by">- John Doe</p>
                    </li>
                    <li class="notification_item" data-detail="Another meeting detail here.">
                        <p>Schedule Update <span>Yesterday</span></p>
                        <p class="short-description">Another meeting detail here</p>
                        <p class="posted-by">- Sarah Marcos</p>
                    </li>
                    <li class="notification_item" data-detail="Another meeting detail here.">
                        <p>Schedule Update <span>Yesterday</span></p>
                        <p class="short-description">Another meeting detail here</p>
                        <p class="posted-by">- Ginno Arostique</p>
                    </li>
                    <li class="notification_item" data-detail="Another meeting detail here.">
                        <p>Schedule Update <span>Yesterday</span></p>
                        <p class="short-description">Another meeting detail here</p>
                        <p class="posted-by">- Ginno Arostique</p>
                    </li>
                </ul>
            </div>
        </div>
        <!-- Detailed Notification -->
        <div id="detailed_notification" class="hidden">
            <h2 id="notification_title">Schedule Update</h2><p class="notification_date">Yesterday, January 29, 2025</p>
            <button id="close_detailed_notification" class="close-btn">&times;</button>
            <p id="notification_detail"></p>
            <p class="posted-by">- Imee Duterte, Team Head</p>
            <button class="respond-btn">Respond</button>
        </div>
    </div>
    
    <div id="sidebar_icns_grp">
        <div class="nav_item">
            <img id="nav_icon" class="sidebar_icns" style="margin-bottom: -6px;" src="{% static 'Images/Navigation.png' %}" alt="Navigate">
            <p>Navigate</p>
        </div>
        <div class="nav_item">
            <img class="sidebar_icns" src="{% static 'Images/Notification.png' %}" alt="Notification">
            <p id="notification_paragraph">Notification</p>
        </div>
        <div class="nav_item">
            <img class="sidebar_icns" src="{% static 'Images/Settings.png' %}" alt="Settings">
            <p>Settings</p>
        </div>
    </div>
</div>
    
        <div id="header">
            <div>
                <img id="logo" src="{% static 'Images/Logo.png' %}" alt="ARC.AI Logo">
            </div>
            <div id="header_nav" class="text_white">
                <p><a href="{% url 'core:home' %}" class="{% if active_page == 'home' %}active{% endif %}">Home</a></p>
                <p><a href="{% url 'core:organization' %}" class="{% if active_page == 'organization' %}active{% endif %}">Organization</a></p>
                <p><a href="{% url 'core:saved' %}" class="{% if active_page == 'saved' %}active{% endif %}">Saved</a></p>
                <p><a href="{% url 'core:email' %}" class="{% if active_page == 'email' %}active{% endif %}">Email</a></p>
                <p><a href="{% url 'core:profilepage' %}" class="{% if active_page == 'email' %}active{% endif %}">Profile</a></p>
            </div>
            <div>
                <img id="account_icn" src="{% static 'Images/Account.png' %}" alt="Account">
            </div>
        </div>
    <div id="content">

        <div style="display: flex; align-items: center; justify-content: space-between;">
            <h1>Folders</h1>

            <div class="horizontal-line"></div>


            <!-- Dropdown Button -->
            <img src="{% static 'Images/dots copy.png' %}" alt="Dropdown Icon" class="dropdown-icon" onclick="toggleDropdownFolders()" style="width: 40px; height: 40px; cursor: pointer;">
            <div class="dropdown-content" id="myDropdownFolders">
                <!-- Folder Creation -->
                <form action="{% url 'core:create_folder_in_drive' %}" method="post">
                    {% csrf_token %}
                    <input type="text" name="folder_name" placeholder="Folder Name" required>
                    <button type="submit">Create</button>
                </form>
                <hr class="dropdown-divider">

                <!-- DELETE Button -->
                <a href="#" onclick="">DELETE</a>
            </div>
        </div>

            <div id="folder_items">
                {% for folder in folders %}
                    <div class="folder-item">
                        <a href="{% url 'core:view_folder_contents' folder.id %}">{{ folder.name }}</a>
                    </div>
                {% empty %}
                    <p>No folders found.</p>
                {% endfor %}
            </div>



                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <h1 class="titles">Files</h1>
                    
                    <div class="horizontal-line"></div>
                    
                    <!-- Dropdown Button -->
                    <img src="{% static 'Images/dots.png' %}" alt="Dropdown Icon" class="dropdown-icon" onclick="toggleDropdownFiles()" style="width: 40px; height: 40px; cursor: pointer;">
                    <div class="dropdown-content" id="myDropdown">
                        <!-- File Upload -->
                        <form action="{% url 'core:upload_file_to_drive' %}" method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            <input type="hidden" name="folder_id" value="{{ folder_id|default:ROOT_FOLDER_ID }}">
                            <input type="file" name="file" multiple required>
                            <button type="submit">Upload</button>
                        </form>
                        <hr class="dropdown-divider">

                        <!-- DELETE Button --><a href="#" onclick="toggleCheckboxes()">MOVE TO TRASH</a>
                    </div>
                </div>

                <div id="file_items">
                    <ul class="file-list">
                            <div class="horizontal-line"></div>
                            {% for file in files %}
                                <li class="file-item">
                                    <div class="file-icon">
                                        <input type="checkbox" class ="file-checkbox"
                                        style="display: none;" data-file-id="{{ file.file_id }}">
                                        <img src="{% static file.icon %}" alt="File Icon">
                                    </div>
                                    <div class="file-details">
                                        <a href="https://drive.google.com/file/d/{{ file.file_id }}/view" target="_blank" class="file-name">{{ file.name }}</a>
                                        <span class="file-owner">{{ file.owner }}</span>
                                        <span class="file-date">{{ file.date }}</span>
                                        <span class="file-size">{{ file.size }}</span>
                                    </div>
                                    <div class="file-actions">
                                        <button class="action-button">â‹®</button>
                                    </div>
                                </li>
                                <div class="horizontal-line"></div>
                            {% empty %}
                                <li>No files uploaded yet.</li>
                            {% endfor %}
                        </ul>

                    <!-- Single Delete Button that appears when checkboxes are shown -->
                    <button id="delete-selected-btn" style="display: none;" onclick="moveToTrashSelectedFiles()">Move Selected Files to Trash</button>

                    <!-- Keep the form for the CSRF token and folder ID -->
                    <form id="delete-files-form" action="{% url 'core:move_files_to_trash' %}" method="post" style="display: none;">
                        {% csrf_token %}
                        <input type="hidden" name="folder_id" value="{{ folder_id|default:ROOT_FOLDER_ID }}">
                    </form>
                    </div>
                
        

            <div style="display: flex; align-items: center; justify-content: space-between;">


            <h3>Trash</h3>
            <div class="horizontal-line"></div>
            <!-- Dropdown Button -->
            <img src="{% static 'Images/dots copy 2.png' %}" alt="Dropdown Icon" class="dropdown-icon" onclick="toggleDropdownTrash()" style="width: 40px; height: 40px; cursor: pointer;">
            <div class="dropdown-content" id="trashDropdown">
                <!-- Remove All Trash Button -->
                <form action="{% url 'core:empty_trash' %}" method="post">
                    {% csrf_token %}
                    <button type="submit" onclick="return confirm('Are you sure you want to permanently delete all items in trash?')">Remove All Trash</button>
                </form>
            </div>

            </div>
            <div id="file_items">
                <ul>
                {% for file in trash %}
                    <li>
                        <a href="{{ file.webViewLink }}" target="_blank">{{ file.name }}</a>
                    </li>
                {% empty %}
                    <li>Trash is empty</li>
                {% endfor %}
                </ul>


            </div>
    </div>
    <script src="{% static 'js/sidebar.js' %}"></script>
    <script src="{% static 'js/saved.js' %}"></script>
</body>

<script>
    function toggleDropdownFiles() {
        document.getElementById("myDropdown").classList.toggle("show");
    }
    
    // Optional: Close the dropdown if clicking outside
    window.onclick = function(event) {
        // Check if click was NOT on the image
        if (!event.target.classList.contains('dropdown-icon')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            for (var i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }
    function moveToTrashSelectedFiles() {
    const checkboxes = document.querySelectorAll('.file-checkbox:checked');
    const fileIds = Array.from(checkboxes).map(checkbox => checkbox.dataset.fileId);
    const form = document.getElementById('delete-files-form');

    if (fileIds.length === 0) {
        alert('No files selected to move to trash.');
        return;
    }

    if (confirm(`Are you sure you want to move ${fileIds.length} selected file(s) to trash?`)) {
        const formData = new FormData(form);
        fileIds.forEach(fileId => formData.append('file_ids[]', fileId));

        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Check if we're in root folder and redirect accordingly
                if (data.is_root_folder) {
                    window.location.href = '/saved/';
                } else {
                    window.location.href = `/folder/${data.folder_id}/`;
                }
            } else {
                alert(data.error || 'An error occurred while moving files to trash.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while moving files to trash.');
        });
    }
}
</script>
    
</html>